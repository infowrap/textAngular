!function(a,b){b["true"]=a,/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.3.11

See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/
function(){"use strict";var a={ie:function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0];);return b>4?b:a}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},b=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,c=/^(ul|li|ol)$/i,d=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var e,f,g,h,i,j;if(a.ie>8||void 0===a.ie){for(var k=document.styleSheets,l=0;l<k.length;l++)if((0===k[l].media.length||k[l].media.mediaText.match(/(all|screen)/gi))&&k[l].href&&k[l].href.match(/textangular\.(min\.|)css/gi)){e=k[l];break}e||(e=function(){var b=document.createElement("style");return a.webkit&&b.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(b),b.sheet}()),f=function(a,b){return h(e,a,b)},h=function(a,b,c){var d,f;return a.cssRules?d=Math.max(a.cssRules.length-1,0):a.rules&&(d=Math.max(a.rules.length-1,0)),a.insertRule?a.insertRule(b+"{"+c+"}",d):a.addRule(b,c,d),e.rules?f=e.rules[d]:e.cssRules&&(f=e.cssRules[d]),f},j=function(a,b){var c,d;for(c=0;c<b.length;c++)if(b[c].cssText===a.cssText){d=c;break}return d},g=function(a){i(e,a)},i=function(a,b){var c=j(b,a.cssRules||a.rules);a.removeRule?a.removeRule(c):a.deleteRule(c)}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(b){return b?""===b?void 0===a.ie?"div":a.ie<=8?"P":"p":a.ie<=8?b.toUpperCase():b:a.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(a,b){return function(c){var d=angular.element("<div></div>");return d[0].innerHTML=c,angular.forEach(a,function(a){var c=[];a.selector&&""!==a.selector?c=d.find(a.selector):a.customAttribute&&""!==a.customAttribute&&(c=b.getByAttribute(d,a.customAttribute)),angular.forEach(c,function(b){b=angular.element(b),a.selector&&""!==a.selector&&a.customAttribute&&""!==a.customAttribute?void 0!==b.attr(a.customAttribute)&&a.renderLogic(b):a.renderLogic(b)})}),d[0].innerHTML}}]).factory("taFixChrome",function(){var a=function(a){if(!a||!angular.isString(a)||a.length<=0)return a;for(var b,c,d,e=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,f="",g=0;b=e.exec(a);)c=b[3]||b[4],c&&c.match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(c=c.replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,""),d="<"+b[1].trim(),c.length>0&&(d+=" style="+b[2].substring(0,1)+c+b[2].substring(0,1)),d+=b[5].trim()+">",f+=a.substring(g,b.index)+d,g=b.index+b[0].length);return f+=a.substring(g),g>0?f.replace(/<span\s*>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):a};return a}).factory("taSanitize",["$sanitize",function(a){function b(a,b){for(var c,d=0,e=0,f=/<[^>]*>/gi;c=f.exec(a);)if(e=c.index,"/"===c[0].substr(1,1)){if(0===d)break;d--}else d++;return b+a.substring(0,e)+angular.element(b)[0].outerHTML.substring(b.length)+a.substring(e)}function c(a){if(!a||!angular.isString(a)||a.length<=0)return a;for(var d,f,g,h,i,k,l=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,m="",n="",o=0;f=l.exec(a);){h=f[3]||f[4];var p=new RegExp(j,"i");if(angular.isString(h)&&p.test(h)){i="";for(var q=new RegExp(j,"ig");g=q.exec(h);)for(d=0;d<e.length;d++)g[2*d+2]&&(i+="<"+e[d].tag+">");k=c(a.substring(o,f.index)),n+=m.length>0?b(k,m):k,h=h.replace(new RegExp(j,"ig"),""),n+="<"+f[1].trim(),h.length>0&&(n+=' style="'+h+'"'),n+=f[5]+">",o=f.index+f[0].length,m=i}}return n+=m.length>0?b(a.substring(o),m):a.substring(o)}function d(a){if(!a||!angular.isString(a)||a.length<=0)return a;for(var b,c=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,d="",e=0;b=c.exec(a);){d+=a.substring(e,b.index),e=b.index+b[0].length;var f="<"+b[1]+b[5];/style=("([^"]+)"|'([^']+)')/gi.test(f)?f=f.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(b[3]||b[4])+';"'):f+=' style="text-align:'+(b[3]||b[4])+';"',f+=">",d+=f}return d+a.substring(e)}for(var e=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],f=[],g=0;g<e.length;g++){for(var h="("+e[g].property+":\\s*(",i=0;i<e[g].values.length;i++)i>0&&(h+="|"),h+=e[g].values[i];h+=");)",f.push(h)}var j="("+f.join("|")+")";return function(b,e,f){if(!f)try{b=c(b)}catch(g){}b=d(b);var h;try{h=a(b),f&&(h=b)}catch(g){h=e||""}var i,j=h.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),k=h.replace(/(&#(9|10);)*/gi,""),l=/<pre[^>]*>.*?<\/pre[^>]*>/gi,m=0,n=0;for(h="";null!==(i=l.exec(k))&&m<j.length;)h+=k.substring(n,i.index)+j[m],n=i.index+i[0].length,m++;return h+k.substring(n)}}]).factory("taToolExecuteAction",["$q","$log",function(a,b){return function(c){void 0!==c&&(this.$editor=function(){return c});var d=a.defer(),e=d.promise,f=this.$editor();e["finally"](function(){f.endAction.call(f)});var g;try{g=this.action(d,f.startAction())}catch(h){b.error(h)}(g||void 0===g)&&d.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(a,d,e){var f=function(b,c){var d,e,f=b.find("li");for(e=f.length-1;e>=0;e--)d=angular.element("<"+c+">"+f[e].innerHTML+"</"+c+">"),b.after(d);b.remove(),a.setSelectionToElementEnd(d[0])},g=function(b){/(<br(|\/)>)$/i.test(b.innerHTML.trim())?a.setSelectionBeforeElement(angular.element(b).find("br")[0]):a.setSelectionToElementEnd(b)},h=function(a,b){var c=angular.element("<"+b+">"+a[0].innerHTML+"</"+b+">");a.after(c),a.remove(),g(c.find("li")[0])},i=function(a,b,c){for(var e="",f=0;f<a.length;f++)e+="<"+d("li")+">"+a[f].innerHTML+"</"+d("li")+">";var h=angular.element("<"+c+">"+e+"</"+c+">");b.after(h),b.remove(),g(h.find("li")[0])};return function(g,j){return g=d(g),function(k,l,m){var n,o,p,q,r,s,t,u=angular.element("<"+g+">");try{t=a.getSelectionElement()}catch(v){}var w=angular.element(t);if(void 0!==t){var x=t.tagName.toLowerCase();if("insertorderedlist"===k.toLowerCase()||"insertunorderedlist"===k.toLowerCase()){var y=d("insertorderedlist"===k.toLowerCase()?"ol":"ul");if(x===y)return f(w,g);if("li"===x&&w.parent()[0].tagName.toLowerCase()===y&&1===w.parent().children().length)return f(w.parent(),g);if("li"===x&&w.parent()[0].tagName.toLowerCase()!==y&&1===w.parent().children().length)return h(w.parent(),y);if(x.match(b)&&!w.hasClass("ta-bind")){if("ol"===x||"ul"===x)return h(w,y);var z=!1;return angular.forEach(w.children(),function(a){a.tagName.match(b)&&(z=!0)}),z?i(w.children(),w,y):i([angular.element("<div>"+t.innerHTML+"</div>")[0]],w,y)}if(x.match(b)){if(q=a.getOnlySelectedElements(),0===q.length)o=angular.element("<"+y+"><li>"+t.innerHTML+"</li></"+y+">"),w.html(""),w.append(o);else{if(1===q.length&&("ol"===q[0].tagName.toLowerCase()||"ul"===q[0].tagName.toLowerCase()))return q[0].tagName.toLowerCase()===y?f(angular.element(q[0]),g):h(angular.element(q[0]),y);p="";var A=[];for(n=0;n<q.length;n++)if(3!==q[n].nodeType){var B=angular.element(q[n]);if("li"===q[n].tagName.toLowerCase())continue;p+="ol"===q[n].tagName.toLowerCase()||"ul"===q[n].tagName.toLowerCase()?B[0].innerHTML:"span"!==q[n].tagName.toLowerCase()||"ol"!==q[n].childNodes[0].tagName.toLowerCase()&&"ul"!==q[n].childNodes[0].tagName.toLowerCase()?"<"+d("li")+">"+B[0].innerHTML+"</"+d("li")+">":B[0].childNodes[0].innerHTML,A.unshift(B)}o=angular.element("<"+y+">"+p+"</"+y+">"),A.pop().replaceWith(o),angular.forEach(A,function(a){a.remove()})}return void a.setSelectionToElementEnd(o[0])}}else{if("formatblock"===k.toLowerCase()){for(s=m.toLowerCase().replace(/[<>]/gi,""),"default"===s.trim()&&(s=g,m="<"+g+">"),o="li"===x?w.parent():w;!o[0].tagName||!o[0].tagName.match(b)&&!o.parent().attr("contenteditable");)o=o.parent(),x=(o[0].tagName||"").toLowerCase();if(x===s){q=o.children();var C=!1;for(n=0;n<q.length;n++)C=C||q[n].tagName.match(b);C?(o.after(q),r=o.next(),o.remove(),o=r):(u.append(o[0].childNodes),o.after(u),o.remove(),o=u)}else if(o.parent()[0].tagName.toLowerCase()!==s||o.parent().hasClass("ta-bind"))if(x.match(c))o.wrap(m);else{for(q=a.getOnlySelectedElements(),0===q.length&&(q=[o[0]]),n=0;n<q.length;n++)if(3===q[n].nodeType||!q[n].tagName.match(b))for(;3===q[n].nodeType||!q[n].tagName||!q[n].tagName.match(b);)q[n]=q[n].parentNode;if(angular.element(q[0]).hasClass("ta-bind"))o=angular.element(m),o[0].innerHTML=q[0].innerHTML,q[0].innerHTML=o[0].outerHTML;else if("blockquote"===s){for(p="",n=0;n<q.length;n++)p+=q[n].outerHTML;for(o=angular.element(m),o[0].innerHTML=p,q[0].parentNode.insertBefore(o[0],q[0]),n=q.length-1;n>=0;n--)q[n].parentNode&&q[n].parentNode.removeChild(q[n])}else for(n=0;n<q.length;n++)o=angular.element(m),o[0].innerHTML=q[n].innerHTML,q[n].parentNode.insertBefore(o[0],q[n]),q[n].parentNode.removeChild(q[n])}else{var D=o.parent(),E=D.contents();for(n=0;n<E.length;n++)D.parent().hasClass("ta-bind")&&3===E[n].nodeType&&(u=angular.element("<"+g+">"),u[0].innerHTML=E[n].outerHTML,E[n]=u[0]),D.parent()[0].insertBefore(E[n],D[0]);D.remove()}return void a.setSelectionToElementEnd(o[0])}if("createlink"===k.toLowerCase()){var F=a.getSelection();if(F.collapsed)return void a.insertHtml('<a href="'+m+'">'+m+"</a>",j)}else if("inserthtml"===k.toLowerCase())return void a.insertHtml(m,j)}}try{e[0].execCommand(k,l,m)}catch(v){}}}}]).service("taSelection",["$window","$document","taDOM",function(a,c,e){var f=c[0],g=function(a,b){return a.tagName&&a.tagName.match(/^br$/i)&&0===b&&!a.previousSibling?{element:a.parentNode,offset:0}:{element:a,offset:b}},h={getSelection:function(){var b=a.rangy.getSelection().getRangeAt(0),c=b.commonAncestorContainer,d={start:g(b.startContainer,b.startOffset),end:g(b.endContainer,b.endOffset),collapsed:b.collapsed};return c=3===c.nodeType?c.parentNode:c,d.container=c.parentNode===d.start.element||c.parentNode===d.end.element?c.parentNode:c,d},getOnlySelectedElements:function(){var b=a.rangy.getSelection().getRangeAt(0),c=b.commonAncestorContainer;return c=3===c.nodeType?c.parentNode:c,b.getNodes([1],function(a){return a.parentNode===c})},getSelectionElement:function(){return h.getSelection().container},setSelection:function(b,c,d){var e=a.rangy.createRange();e.setStart(b,c),e.setEnd(b,d),a.rangy.getSelection().setSingleRange(e)},setSelectionBeforeElement:function(b){var c=a.rangy.createRange();c.selectNode(b),c.collapse(!0),a.rangy.getSelection().setSingleRange(c)},setSelectionAfterElement:function(b){var c=a.rangy.createRange();c.selectNode(b),c.collapse(!1),a.rangy.getSelection().setSingleRange(c)},setSelectionToElementStart:function(b){var c=a.rangy.createRange();c.selectNodeContents(b),c.collapse(!0),a.rangy.getSelection().setSingleRange(c)},setSelectionToElementEnd:function(b){var c=a.rangy.createRange();c.selectNodeContents(b),c.collapse(!1),b.childNodes&&b.childNodes[b.childNodes.length-1]&&"br"===b.childNodes[b.childNodes.length-1].nodeName&&(c.startOffset=c.endOffset=c.startOffset-1),a.rangy.getSelection().setSingleRange(c)},insertHtml:function(c,g){var i,j,k,l,m,n,o,p=angular.element("<div>"+c+"</div>"),q=a.rangy.getSelection().getRangeAt(0),r=f.createDocumentFragment(),s=p[0].childNodes,t=!0;if(s.length>0){for(l=[],k=0;k<s.length;k++)"p"===s[k].nodeName.toLowerCase()&&""===s[k].innerHTML.trim()||3===s[k].nodeType&&""===s[k].nodeValue.trim()||(t=t&&!b.test(s[k].nodeName),l.push(s[k]));for(var u=0;u<l.length;u++)n=r.appendChild(l[u]);!t&&q.collapsed&&/^(|<br(|\/)>)$/i.test(q.startContainer.innerHTML)&&q.selectNode(q.startContainer)}else t=!0,n=r=f.createTextNode(c);if(t)q.deleteContents();else if(q.collapsed&&q.startContainer!==g)if(q.startContainer.innerHTML&&q.startContainer.innerHTML.match(/^<[^>]*>$/i))i=q.startContainer,1===q.startOffset?(q.setStartAfter(i),q.setEndAfter(i)):(q.setStartBefore(i),q.setEndBefore(i));else{if(3===q.startContainer.nodeType&&q.startContainer.parentNode!==g)for(i=q.startContainer.parentNode,j=i.cloneNode(),e.splitNodes(i.childNodes,i,j,q.startContainer,q.startOffset);!d.test(i.nodeName);){angular.element(i).after(j),i=i.parentNode;var v=j;j=i.cloneNode(),e.splitNodes(i.childNodes,i,j,v)}else i=q.startContainer,j=i.cloneNode(),e.splitNodes(i.childNodes,i,j,void 0,void 0,q.startOffset);if(angular.element(i).after(j),q.setStartAfter(i),q.setEndAfter(i),/^(|<br(|\/)>)$/i.test(i.innerHTML.trim())&&(q.setStartBefore(i),q.setEndBefore(i),angular.element(i).remove()),/^(|<br(|\/)>)$/i.test(j.innerHTML.trim())&&angular.element(j).remove(),"li"===i.nodeName.toLowerCase()){for(o=f.createDocumentFragment(),m=0;m<r.childNodes.length;m++)p=angular.element("<li>"),e.transferChildNodes(r.childNodes[m],p[0]),e.transferNodeAttributes(r.childNodes[m],p[0]),o.appendChild(p[0]);r=o,n&&(n=r.childNodes[r.childNodes.length-1],n=n.childNodes[n.childNodes.length-1])}}else q.deleteContents();q.insertNode(r),n&&h.setSelectionToElementEnd(n)}};return h}]).service("taDOM",function(){var a={getByAttribute:function(b,c){var d=[],e=b.children();return e.length&&angular.forEach(e,function(b){d=d.concat(a.getByAttribute(angular.element(b),c))}),void 0!==b.attr(c)&&d.push(b),d},transferChildNodes:function(a,b){for(b.innerHTML="";a.childNodes.length>0;)b.appendChild(a.childNodes[0]);return b},splitNodes:function(b,c,d,e,f,g){if(!e&&isNaN(g))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var h=document.createDocumentFragment(),i=document.createDocumentFragment(),j=0;b.length>0&&(isNaN(g)||g!==j)&&b[0]!==e;)h.appendChild(b[0]),j++;for(!isNaN(f)&&f>=0&&b[0]&&(h.appendChild(document.createTextNode(b[0].nodeValue.substring(0,f))),b[0].nodeValue=b[0].nodeValue.substring(f));b.length>0;)i.appendChild(b[0]);a.transferChildNodes(h,c),a.transferChildNodes(i,d)},transferNodeAttributes:function(a,b){for(var c=0;c<a.attributes.length;c++)b.setAttribute(a.attributes[c].name,a.attributes[c].value);return b}};return a}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var a=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(b){return function(c){if(!c)return!0;var d,e=/(^[^<]|>)[^<]/i.exec(c);return e?d=e.index:(c=c.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),d=c.indexOf(">")),c=c.trim().substring(d,d+100),/^[^<>]+$/i.test(c)?!1:0===c.length||c===b||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(c)?!0:/>\s*[^\s<]/i.test(c)||a.test(c)?!1:!0}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","_taBlankTest","$parse","taDOM",function(c,e,h,i,j,k,l,m,n,o,p,q){return{require:"ngModel",link:function(k,r,s,t){var u,v,w,x,y=void 0!==r.attr("contenteditable")&&r.attr("contenteditable"),z=y||"textarea"===r[0].tagName.toLowerCase()||"input"===r[0].tagName.toLowerCase(),A=!1,B=!1,C=!1,D=s.taUnsafeSanitizer,E=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,F=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;void 0===s.taDefaultWrap&&(s.taDefaultWrap="p"),""===s.taDefaultWrap?(w="",x=void 0===a.ie?"<div><br></div>":a.ie>=11?"<p><br></p>":a.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(w=void 0===a.ie||a.ie>=11?"<"+s.taDefaultWrap+"><br></"+s.taDefaultWrap+">":a.ie<=8?"<"+s.taDefaultWrap.toUpperCase()+"></"+s.taDefaultWrap.toUpperCase()+">":"<"+s.taDefaultWrap+"></"+s.taDefaultWrap+">",x=void 0===a.ie||a.ie>=11?"<"+s.taDefaultWrap+"><br></"+s.taDefaultWrap+">":a.ie<=8?"<"+s.taDefaultWrap.toUpperCase()+">&nbsp;</"+s.taDefaultWrap.toUpperCase()+">":"<"+s.taDefaultWrap+">&nbsp;</"+s.taDefaultWrap+">");var G=o(x),H=function(a){if(G(a))return a;var c=angular.element("<div>"+a+"</div>");if(0===c.children().length)a="<"+s.taDefaultWrap+">"+a+"</"+s.taDefaultWrap+">";else{var d,e=c[0].childNodes,f=!1;for(d=0;d<e.length&&!(f=e[d].nodeName.toLowerCase().match(b));d++);if(f)for(a="",d=0;d<e.length;d++)if(e[d].nodeName.toLowerCase().match(b))a+=e[d].outerHTML;else{var g=e[d].outerHTML||e[d].nodeValue;a+=""!==g.trim()?"<"+s.taDefaultWrap+">"+g+"</"+s.taDefaultWrap+">":g}else a="<"+s.taDefaultWrap+">"+a+"</"+s.taDefaultWrap+">"}return a};s.taPaste&&(v=p(s.taPaste)),r.addClass("ta-bind");var I;k["$undoManager"+(s.id||"")]=t.$undoManager={_stack:[],_index:0,_max:1e3,push:function(a){return"undefined"==typeof a||null===a||"undefined"!=typeof this.current()&&null!==this.current()&&a===this.current()?a:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(a),I&&e.cancel(I),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,a)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(a){return 0>a||a>this._stack.length-1?void 0:(this._index=a,this.current())},current:function(){return this._stack[this._index]}};var J=k["$undoTaBind"+(s.id||"")]=function(){if(!A&&y){var a=t.$undoManager.undo();"undefined"!=typeof a&&null!==a&&(X(a),M(a,!1),l.setSelectionToElementEnd(r[0].childNodes.length?r[0].childNodes[r[0].childNodes.length-1]:r[0]))}},K=k["$redoTaBind"+(s.id||"")]=function(){if(!A&&y){var a=t.$undoManager.redo();"undefined"!=typeof a&&null!==a&&(X(a),M(a,!1),l.setSelectionToElementEnd(r[0].childNodes.length?r[0].childNodes[r[0].childNodes.length-1]:r[0]))}},L=function(){if(y)return r[0].innerHTML;if(z)return r.val();throw"textAngular Error: attempting to update non-editable taBind"},M=function(a,b){C=!0,("undefined"==typeof b||null===b)&&(b=!0&&y),("undefined"==typeof a||null===a)&&(a=L()),G(a)?(""!==t.$viewValue&&t.$setViewValue(""),b&&""!==t.$undoManager.current()&&t.$undoManager.push("")):(W(),t.$viewValue!==a&&(t.$setViewValue(a),b&&t.$undoManager.push(a)))};k["updateTaBind"+(s.id||"")]=function(){A||M()};var N=function(a){return t.$oldViewValue=c(j(a),t.$oldViewValue,D)},O=function(a){return s.required&&t.$setValidity("required",!G(a)),a};if(t.$parsers.push(N),t.$parsers.unshift(H),t.$parsers.unshift(O),t.$formatters.push(N),t.$formatters.unshift(H),t.$formatters.unshift(O),t.$formatters.unshift(function(a){return t.$undoManager.push(a||"")}),z)if(k.events={},y){var P=!1,Q=function(a){if(a&&a.trim().length){if(a.match(/class=["']*Mso(Normal|List)/i)){var b=a.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);b=b?b[1]:a,b=b.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var d=angular.element("<div>"+b+"</div>"),f=angular.element("<div></div>"),g={element:null,lastIndent:[],lastLi:null,isUl:!1};g.lastIndent.peek=function(){var a=this.length;return a>0?this[a-1]:void 0};for(var h=function(a){g.isUl=a,g.element=angular.element(a?"<ul>":"<ol>"),g.lastIndent=[],g.lastIndent.peek=function(){var a=this.length;return a>0?this[a-1]:void 0},g.lastLevelMatch=null},i=0;i<=d[0].childNodes.length;i++)if(d[0].childNodes[i]&&"#text"!==d[0].childNodes[i].nodeName&&"p"===d[0].childNodes[i].tagName.toLowerCase()){var j=angular.element(d[0].childNodes[i]),m=(j.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(m){if(j[0].childNodes.length<2||j[0].childNodes[1].childNodes.length<1)continue;var n="bullet"===m[1].toLowerCase()||"number"!==m[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(j[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(j[0].childNodes[1].childNodes[0].innerHTML)),o=(j.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),p=parseFloat(o?o[1]:0),s=(j.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(s&&s[2]&&(p=parseInt(s[2])),s&&(!g.lastLevelMatch||s[1]!==g.lastLevelMatch[1])||!m[3]||"first"===m[3].toLowerCase()||null===g.lastIndent.peek()||g.isUl!==n&&g.lastIndent.peek()===p)h(n),f.append(g.element);else if(null!=g.lastIndent.peek()&&g.lastIndent.peek()<p)g.element=angular.element(n?"<ul>":"<ol>"),g.lastLi.append(g.element);else if(null!=g.lastIndent.peek()&&g.lastIndent.peek()>p){for(;null!=g.lastIndent.peek()&&g.lastIndent.peek()>p;)if("li"!==g.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(g.element.parent()[0].tagName.toLowerCase()))break;g.element=g.element.parent(),g.lastIndent.pop()}else g.element=g.element.parent();g.isUl="ul"===g.element[0].tagName.toLowerCase(),n!==g.isUl&&(h(n),f.append(g.element))}g.lastLevelMatch=s,p!==g.lastIndent.peek()&&g.lastIndent.push(p),g.lastLi=angular.element("<li>"),g.element.append(g.lastLi),g.lastLi.html(j.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),j.remove()}else h(!1),f.append(j)}var u=function(a){a=angular.element(a);for(var b=a[0].childNodes.length-1;b>=0;b--)a.after(a[0].childNodes[b]);a.remove()};angular.forEach(f.find("span"),function(a){a.removeAttribute("lang"),a.attributes.length<=0&&u(a)}),angular.forEach(f.find("font"),u),a=f.html()}else{if(a=a.replace(/<(|\/)meta[^>]*?>/gi,""),a.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(a.match(/<[^>]*?(text-angular)[^>]*?>/)){var w=angular.element("<div>"+a+"</div>");w.find("textarea").remove();for(var x=q.getByAttribute(w,"ta-bind"),y=0;y<x.length;y++){for(var z=x[y][0].parentNode.parentNode,A=0;A<x[y][0].childNodes.length;A++)z.parentNode.insertBefore(x[y][0].childNodes[A],z);z.parentNode.removeChild(z)}a=w.html().replace('<br class="Apple-interchange-newline">',"")}}else a.match(/^<span/)&&(a=a.replace(/<(|\/)span[^>]*?>/gi,""));a=a.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}a=c(a,"",D),v&&(a=v(k,{$html:a})||a),l.insertHtml(a,r[0]),e(function(){t.$setViewValue(L()),P=!1,r.removeClass("processing-paste")},0)}else P=!1,r.removeClass("processing-paste")};if(r.on("paste",k.events.paste=function(a,b){if(b&&angular.extend(a,b),A||P)return a.stopPropagation(),a.preventDefault(),!1;P=!0,r.addClass("processing-paste");var c,d=(a.originalEvent||a).clipboardData;if(d&&d.getData&&d.types.length>0){for(var f="",g=0;g<d.types.length;g++)f+=" "+d.types[g];return/text\/html/i.test(f)?c=d.getData("text/html"):/text\/plain/i.test(f)&&(c=d.getData("text/plain")),Q(c),a.stopPropagation(),a.preventDefault(),!1}var j=h.rangy.saveSelection(),k=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');i.find("body").append(k),k[0].focus(),e(function(){h.rangy.restoreSelection(j),Q(k[0].innerHTML),r[0].focus(),k.remove()},0)}),r.on("cut",k.events.cut=function(a){A?a.preventDefault():e(function(){t.$setViewValue(L())},0)}),r.on("keydown",k.events.keydown=function(a,b){if(b&&angular.extend(a,b),!A)if(a.altKey||!a.metaKey&&!a.ctrlKey){if(13===a.keyCode&&!a.shiftKey){var c,e=l.getSelectionElement();if(!e.tagName.match(d))return;var f=angular.element(w);if(/^<br(|\/)>$/i.test(e.innerHTML.trim())&&"blockquote"===e.parentNode.tagName.toLowerCase()&&!e.nextSibling){c=angular.element(e);var g=c.parent();g.after(f),c.remove(),0===g.children().length&&g.remove(),l.setSelectionToElementStart(f[0]),a.preventDefault()}else/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(e.innerHTML.trim())&&"blockquote"===e.tagName.toLowerCase()&&(c=angular.element(e),c.after(f),c.remove(),l.setSelectionToElementStart(f[0]),a.preventDefault())}}else 90!==a.keyCode||a.shiftKey?(90===a.keyCode&&a.shiftKey||89===a.keyCode&&!a.shiftKey)&&(K(),a.preventDefault()):(J(),a.preventDefault())}),r.on("keyup",k.events.keyup=function(a,b){if(b&&angular.extend(a,b),9===a.keyCode){var c=l.getSelection();return void(c.start.element===r[0]&&r.children().length&&l.setSelectionToElementStart(r.children()[0]))}if(I&&e.cancel(I),!A&&!E.test(a.keyCode)){if(""!==w&&13===a.keyCode&&!a.shiftKey){for(var f=l.getSelectionElement();!f.tagName.match(d)&&f!==r[0];)f=f.parentNode;if(f.tagName.toLowerCase()!==s.taDefaultWrap&&"li"!==f.tagName.toLowerCase()&&(""===f.innerHTML.trim()||"<br>"===f.innerHTML.trim())){var g=angular.element(w);angular.element(f).replaceWith(g),l.setSelectionToElementStart(g[0])}}var i=L();if(""!==w&&""===i.trim())X(w),l.setSelectionToElementStart(r.children()[0]);else if("<"!==i.substring(0,1)&&""!==s.taDefaultWrap){var j=h.rangy.saveSelection();i=L(),i="<"+s.taDefaultWrap+">"+i+"</"+s.taDefaultWrap+">",X(i),h.rangy.restoreSelection(j)}var k=u!==a.keyCode&&F.test(a.keyCode);M(i,k),k||(I=e(function(){t.$undoManager.push(i)},250)),u=a.keyCode}}),r.on("blur",k.events.blur=function(){B=!1,A||M(),C=!0,t.$render()}),s.placeholder&&(a.ie>8||void 0===a.ie)){var R;if(!s.id)throw"textAngular Error: An unique ID is required for placeholders to work";R=f("#"+s.id+".placeholder-text:before",'content: "'+s.placeholder+'"'),k.$on("$destroy",function(){g(R)})}r.on("focus",k.events.focus=function(){B=!0,r.removeClass("placeholder-text")}),r.on("mouseup",k.events.mouseup=function(){var a=l.getSelection();a.start.element===r[0]&&r.children().length&&l.setSelectionToElementStart(r.children()[0])}),r.on("mousedown",k.events.mousedown=function(a,b){b&&angular.extend(a,b),a.stopPropagation()})}else{r.on("change blur",k.events.change=k.events.blur=function(){A||t.$setViewValue(L())}),r.on("keydown",k.events.keydown=function(a,b){if(b&&angular.extend(a,b),9===a.keyCode){var c=this.selectionStart,d=this.selectionEnd,e=r.val();if(a.shiftKey){var f=e.lastIndexOf("\n",c),g=e.lastIndexOf("	",c);-1!==g&&g>=f&&(r.val(e.substring(0,g)+e.substring(g+1)),this.selectionStart=this.selectionEnd=c-1)}else r.val(e.substring(0,c)+"	"+e.substring(d)),this.selectionStart=this.selectionEnd=c+1;a.preventDefault()}});var S=function(a,b){for(var c="",d=0;b>d;d++)c+=a;return c},T=function(a,b){var c="",d=a.childNodes;b++,c+=S("	",b-1)+a.outerHTML.substring(0,a.outerHTML.indexOf("<li"));for(var e=0;e<d.length;e++)d[e].outerHTML&&(c+="ul"===d[e].nodeName.toLowerCase()||"ol"===d[e].nodeName.toLowerCase()?"\n"+T(d[e],b):"\n"+S("	",b)+d[e].outerHTML);return c+="\n"+S("	",b-1)+a.outerHTML.substring(a.outerHTML.lastIndexOf("<"))};t.$formatters.unshift(function(a){var b=angular.element("<div>"+a+"</div>")[0].childNodes;if(b.length>0){a="";for(var c=0;c<b.length;c++)b[c].outerHTML&&(a.length>0&&(a+="\n"),a+="ul"===b[c].nodeName.toLowerCase()||"ol"===b[c].nodeName.toLowerCase()?""+T(b[c],0):""+b[c].outerHTML)}return a})}var U=function(a){return k.$emit("ta-element-select",this),a.preventDefault(),!1},V=function(a,b){if(b&&angular.extend(a,b),!dropFired&&!A){dropFired=!0;var c;c=a.originalEvent?a.originalEvent.dataTransfer:a.dataTransfer,k.$emit("ta-drop-event",this,a,c),e(function(){dropFired=!1,M()},100)}},W=k["reApplyOnSelectorHandlers"+(s.id||"")]=function(){A||angular.forEach(m,function(a){r.find(a).off("click",U).on("click",U)})},X=function(a){r[0].innerHTML=a};t.$render=function(){var a=t.$viewValue||"";C||(y&&B&&(r.removeClass("placeholder-text"),r[0].blur(),e(function(){r[0].focus(),l.setSelectionToElementEnd(r.children()[r.children().length-1])},1)),y?(X(s.placeholder?""===a?w:a:""===a?w:a),A?r.off("drop",V):(W(),r.on("drop",V))):"textarea"!==r[0].tagName.toLowerCase()&&"input"!==r[0].tagName.toLowerCase()?X(n(a)):r.val(a)),y&&s.placeholder&&(""===a?B?r.removeClass("placeholder-text"):r.addClass("placeholder-text"):r.removeClass("placeholder-text")),C=!1},s.taReadonly&&(A=k.$eval(s.taReadonly),A?(r.addClass("ta-readonly"),("textarea"===r[0].tagName.toLowerCase()||"input"===r[0].tagName.toLowerCase())&&r.attr("disabled","disabled"),void 0!==r.attr("contenteditable")&&r.attr("contenteditable")&&r.removeAttr("contenteditable")):(r.removeClass("ta-readonly"),"textarea"===r[0].tagName.toLowerCase()||"input"===r[0].tagName.toLowerCase()?r.removeAttr("disabled"):y&&r.attr("contenteditable","true")),k.$watch(s.taReadonly,function(a,b){b!==a&&(a?(r.addClass("ta-readonly"),("textarea"===r[0].tagName.toLowerCase()||"input"===r[0].tagName.toLowerCase())&&r.attr("disabled","disabled"),void 0!==r.attr("contenteditable")&&r.attr("contenteditable")&&r.removeAttr("contenteditable"),angular.forEach(m,function(a){r.find(a).on("click",U)}),r.off("drop",V)):(r.removeClass("ta-readonly"),"textarea"===r[0].tagName.toLowerCase()||"input"===r[0].tagName.toLowerCase()?r.removeAttr("disabled"):y&&r.attr("contenteditable","true"),angular.forEach(m,function(a){r.find(a).off("click",U)}),r.on("drop",V)),A=a)}))}}}])}()}({},function(){return this}());